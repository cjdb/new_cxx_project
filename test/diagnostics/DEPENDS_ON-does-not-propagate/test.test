RUN: %rm %t
RUN: %new-project %t/expected_error --author='new-c++-project Test Suite'
RUN: cp %S/CMakeLists.txt %t/expected_error/source/CMakeLists.txt
RUN: cp %S/*pp %t/expected_error/source/.
RUN: cmake -S %t/expected_error -B %t/build -GNinja -DCMAKE_BUILD_TYPE=Debug
RUN: ninja -v -j1 -C %t/build >%t/actual_error 2>&1 || %expect-error
RUN: %{replace_path} %t/actual_error | FileCheck %s

CHECK:      ninja: Entering directory `/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/build'
CHECK-NEXT: [1/12] /usr/bin/c++ -Dmake_fancy_EXPORTS -I/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source -g -std=gnu++23 -fPIC -E -x c++ /build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source/make_fancy.cpp -MT source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o.ddi -MD -MF source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o.ddi.d -fmodules-ts -fdeps-file=source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o.ddi -fdeps-target=source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o -fdeps-format=p1689r5 -o source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o.ddi.i
CHECK-NEXT: [2/12] /usr/bin/cmake -E cmake_ninja_dyndep --tdi=source/CMakeFiles/make_fancy.dir/CXXDependInfo.json --lang=CXX --modmapfmt=gcc --dd=source/CMakeFiles/make_fancy.dir/CXX.dd @source/CMakeFiles/make_fancy.dir/CXX.dd.rsp
CHECK-NEXT: [3/12] /usr/bin/c++  -I/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source -g -std=gnu++23 -E -x c++ /build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source/greeter.cpp -MT source/CMakeFiles/greeting.dir/greeter.cpp.o.ddi -MD -MF source/CMakeFiles/greeting.dir/greeter.cpp.o.ddi.d -fmodules-ts -fdeps-file=source/CMakeFiles/greeting.dir/greeter.cpp.o.ddi -fdeps-target=source/CMakeFiles/greeting.dir/greeter.cpp.o -fdeps-format=p1689r5 -o source/CMakeFiles/greeting.dir/greeter.cpp.o.ddi.i
CHECK-NEXT: [4/12] /usr/bin/c++ -Dmake_fancy_EXPORTS -I/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source -g -std=gnu++23 -fPIC -MD -MT source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o -MF source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o.d -fmodules-ts -fmodule-mapper=source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o.modmap -MD -fdeps-format=p1689r5 -x c++ -o source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o -c /build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source/make_fancy.cpp
CHECK-NEXT: [5/12] /usr/bin/cmake -E cmake_ninja_dyndep --tdi=source/CMakeFiles/greeting.dir/CXXDependInfo.json --lang=CXX --modmapfmt=gcc --dd=source/CMakeFiles/greeting.dir/CXX.dd @source/CMakeFiles/greeting.dir/CXX.dd.rsp
CHECK-NEXT: [6/12] /usr/bin/c++  -I/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source -g -std=gnu++23 -E -x c++ /build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source/hello.cpp -MT source/CMakeFiles/hello.dir/hello.cpp.o.ddi -MD -MF source/CMakeFiles/hello.dir/hello.cpp.o.ddi.d -fmodules-ts -fdeps-file=source/CMakeFiles/hello.dir/hello.cpp.o.ddi -fdeps-target=source/CMakeFiles/hello.dir/hello.cpp.o -fdeps-format=p1689r5 -o source/CMakeFiles/hello.dir/hello.cpp.o.ddi.i
CHECK-NEXT: [7/12] : && /usr/bin/c++ -fPIC -g   -shared -Wl,-soname,libmake_fancy.so -o source/libmake_fancy.so source/CMakeFiles/make_fancy.dir/make_fancy.cpp.o  -s && :
CHECK-NEXT: [8/12] /usr/bin/c++  -I/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source -g -std=gnu++23 -MD -MT source/CMakeFiles/greeting.dir/greeter.cpp.o -MF source/CMakeFiles/greeting.dir/greeter.cpp.o.d -fmodules-ts -fmodule-mapper=source/CMakeFiles/greeting.dir/greeter.cpp.o.modmap -MD -fdeps-format=p1689r5 -x c++ -o source/CMakeFiles/greeting.dir/greeter.cpp.o -c /build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source/greeter.cpp
CHECK-NEXT: [9/12] /usr/bin/cmake -E cmake_ninja_dyndep --tdi=source/CMakeFiles/hello.dir/CXXDependInfo.json --lang=CXX --modmapfmt=gcc --dd=source/CMakeFiles/hello.dir/CXX.dd @source/CMakeFiles/hello.dir/CXX.dd.rsp
CHECK-NEXT: [10/12] : && /usr/bin/cmake -E rm -f source/libgreeting.a && /usr/bin/ar qc source/libgreeting.a  source/CMakeFiles/greeting.dir/greeter.cpp.o && /usr/bin/ranlib source/libgreeting.a && :
CHECK-NEXT: [11/12] /usr/bin/c++  -I/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source -g -std=gnu++23 -MD -MT source/CMakeFiles/hello.dir/hello.cpp.o -MF source/CMakeFiles/hello.dir/hello.cpp.o.d -fmodules-ts -fmodule-mapper=source/CMakeFiles/hello.dir/hello.cpp.o.modmap -MD -fdeps-format=p1689r5 -x c++ -o source/CMakeFiles/hello.dir/hello.cpp.o -c /build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/expected_error/source/hello.cpp
CHECK-NEXT: [12/12] : && /usr/bin/c++ -g  source/CMakeFiles/hello.dir/hello.cpp.o -o source/hello  -Wl,-rpath,/build/test/diagnostics/DEPENDS_ON-does-not-propagate/Output/test.test.tmp/build/source  source/libgreeting.a  source/libmake_fancy.so && :
